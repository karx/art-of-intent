<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0d1117;
            color: #c9d1d9;
        }
        .test-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #58a6ff;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success {
            background: rgba(63, 185, 80, 0.2);
            border: 1px solid #3fb950;
            color: #3fb950;
        }
        .error {
            background: rgba(248, 81, 73, 0.2);
            border: 1px solid #f85149;
            color: #f85149;
        }
        .pending {
            background: rgba(210, 153, 34, 0.2);
            border: 1px solid #d29922;
            color: #d29922;
        }
        button {
            background: #58a6ff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        button:hover {
            background: #4a8fd8;
        }
        button:disabled {
            background: #30363d;
            cursor: not-allowed;
        }
        pre {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Connection Test</h1>
    
    <div class="test-section">
        <h2>1. Firebase Initialization</h2>
        <div id="initStatus" class="status pending">Testing...</div>
        <pre id="initDetails"></pre>
    </div>
    
    <div class="test-section">
        <h2>2. Authentication</h2>
        <div id="authStatus" class="status pending">Waiting...</div>
        <button id="testAnonBtn">Test Anonymous Sign-In</button>
        <button id="testGoogleBtn">Test Google Sign-In</button>
        <button id="signOutBtn" disabled>Sign Out</button>
        <pre id="authDetails"></pre>
    </div>
    
    <div class="test-section">
        <h2>3. Firestore Database</h2>
        <div id="dbStatus" class="status pending">Waiting...</div>
        <button id="testWriteBtn" disabled>Test Write</button>
        <button id="testReadBtn" disabled>Test Read</button>
        <pre id="dbDetails"></pre>
    </div>
    
    <div class="test-section">
        <h2>4. Console Logs</h2>
        <pre id="consoleLogs"></pre>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCbjBSXYA75T7RWByOk3d10ofoMps145-M",
            authDomain: "art-of-intent.firebaseapp.com",
            projectId: "art-of-intent",
            storageBucket: "art-of-intent.firebasestorage.app",
            messagingSenderId: "401277869938",
            appId: "1:401277869938:web:9d2a35d06e24ff7e8ac7eb",
            measurementId: "G-4FJ7J37XH8"
        };

        let app, auth, db, currentUser;
        const logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            document.getElementById('consoleLogs').textContent = logs.join('\n');
            console.log(message);
        }

        // Test 1: Initialize Firebase
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app, 'alpha'); // Connect to 'alpha' database
            
            document.getElementById('initStatus').className = 'status success';
            document.getElementById('initStatus').textContent = '‚úÖ Firebase initialized successfully';
            document.getElementById('initDetails').textContent = JSON.stringify({
                projectId: firebaseConfig.projectId,
                authDomain: firebaseConfig.authDomain,
                appId: firebaseConfig.appId
            }, null, 2);
            
            log('Firebase initialized successfully', 'success');
        } catch (error) {
            document.getElementById('initStatus').className = 'status error';
            document.getElementById('initStatus').textContent = '‚ùå Firebase initialization failed';
            document.getElementById('initDetails').textContent = error.message;
            log('Firebase initialization failed: ' + error.message, 'error');
        }

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('authStatus').className = 'status success';
                document.getElementById('authStatus').textContent = '‚úÖ User signed in: ' + (user.isAnonymous ? 'Anonymous' : user.email);
                document.getElementById('authDetails').textContent = JSON.stringify({
                    uid: user.uid,
                    email: user.email,
                    isAnonymous: user.isAnonymous,
                    displayName: user.displayName
                }, null, 2);
                
                document.getElementById('signOutBtn').disabled = false;
                document.getElementById('testWriteBtn').disabled = false;
                document.getElementById('testReadBtn').disabled = false;
                
                log('User signed in: ' + user.uid, 'success');
            } else {
                document.getElementById('authStatus').className = 'status pending';
                document.getElementById('authStatus').textContent = '‚ö™ No user signed in';
                document.getElementById('authDetails').textContent = '';
                
                document.getElementById('signOutBtn').disabled = true;
                document.getElementById('testWriteBtn').disabled = true;
                document.getElementById('testReadBtn').disabled = true;
                
                log('User signed out', 'info');
            }
        });

        // Test 2: Anonymous Sign-In
        document.getElementById('testAnonBtn').addEventListener('click', async () => {
            try {
                log('Testing anonymous sign-in...', 'info');
                const result = await signInAnonymously(auth);
                log('Anonymous sign-in successful: ' + result.user.uid, 'success');
            } catch (error) {
                document.getElementById('authStatus').className = 'status error';
                document.getElementById('authStatus').textContent = '‚ùå Anonymous sign-in failed';
                document.getElementById('authDetails').textContent = error.message;
                log('Anonymous sign-in failed: ' + error.message, 'error');
            }
        });

        // Test 3: Google Sign-In
        const googleProvider = new GoogleAuthProvider();
        document.getElementById('testGoogleBtn').addEventListener('click', async () => {
            try {
                log('Testing Google sign-in...', 'info');
                const result = await signInWithPopup(auth, googleProvider);
                log('Google sign-in successful: ' + result.user.email, 'success');
            } catch (error) {
                document.getElementById('authStatus').className = 'status error';
                document.getElementById('authStatus').textContent = '‚ùå Google sign-in failed';
                document.getElementById('authDetails').textContent = error.message;
                log('Google sign-in failed: ' + error.message, 'error');
            }
        });

        // Sign Out
        document.getElementById('signOutBtn').addEventListener('click', async () => {
            try {
                await signOut(auth);
                log('Sign out successful', 'success');
            } catch (error) {
                log('Sign out failed: ' + error.message, 'error');
            }
        });

        // Test 4: Firestore Write
        document.getElementById('testWriteBtn').addEventListener('click', async () => {
            if (!currentUser) {
                log('No user signed in', 'error');
                return;
            }

            try {
                log('Testing Firestore write...', 'info');
                const testDoc = doc(db, 'test', 'connection-test');
                await setDoc(testDoc, {
                    userId: currentUser.uid,
                    timestamp: serverTimestamp(),
                    message: 'Firebase connection test successful!',
                    testNumber: Math.floor(Math.random() * 1000)
                });
                
                document.getElementById('dbStatus').className = 'status success';
                document.getElementById('dbStatus').textContent = '‚úÖ Firestore write successful';
                log('Firestore write successful', 'success');
            } catch (error) {
                document.getElementById('dbStatus').className = 'status error';
                document.getElementById('dbStatus').textContent = '‚ùå Firestore write failed';
                document.getElementById('dbDetails').textContent = error.message;
                log('Firestore write failed: ' + error.message, 'error');
            }
        });

        // Test 5: Firestore Read
        document.getElementById('testReadBtn').addEventListener('click', async () => {
            try {
                log('Testing Firestore read...', 'info');
                const testDoc = doc(db, 'test', 'connection-test');
                const docSnap = await getDoc(testDoc);
                
                if (docSnap.exists()) {
                    document.getElementById('dbStatus').className = 'status success';
                    document.getElementById('dbStatus').textContent = '‚úÖ Firestore read successful';
                    document.getElementById('dbDetails').textContent = JSON.stringify(docSnap.data(), null, 2);
                    log('Firestore read successful', 'success');
                } else {
                    document.getElementById('dbStatus').className = 'status error';
                    document.getElementById('dbStatus').textContent = '‚ùå Document not found';
                    log('Document not found', 'error');
                }
            } catch (error) {
                document.getElementById('dbStatus').className = 'status error';
                document.getElementById('dbStatus').textContent = '‚ùå Firestore read failed';
                document.getElementById('dbDetails').textContent = error.message;
                log('Firestore read failed: ' + error.message, 'error');
            }
        });

        log('Test page loaded', 'info');
    </script>
</body>
</html>
